from TTS.api import TTS
import os
from brain import get_smart_text, save_to_memory, check_cache

# ЁЯУН рдЖрдкрдХреЗ рд▓реЛрдХрд▓ рдореЙрдбрд▓ рдХрд╛ рд░рд╛рд╕реНрддрд╛ (Path)
# рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдХреЗ GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ 'Ramai.pth' рдирд╛рдо рдХрд╛ рдлреЛрд▓реНрдбрд░ рдпрд╛ рдлрд╛рдЗрд▓ рд╣реИ
MODEL_PATH = "./Ramai.pth" 
CONFIG_PATH = "./config.json" # рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ config рдлрд╛рдЗрд▓ рд╣реИ

# рдореЙрдбрд▓ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рд╕рд╣реА рддрд░реАрдХрд╛ (рдмрд┐рдирд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП) [cite: 2026-02-16]
print("ЁЯЪА рдореЙрдбрд▓ рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдХреГрдкрдпрд╛ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ...")
tts = TTS(model_path=MODEL_PATH, config_path=CONFIG_PATH, gpu=True)

def generate_voice(text, output_file="shriram_output.wav"):
    # 1. рдЯрд░реНрдмреЛ рдХреИрд╢ рдЪреЗрдХ рдХрд░реЗрдВ (рдкреБрд░рд╛рдирд╛ рдмрдирд╛ рд╣реБрдЖ рдСрдбрд┐рдпреЛ рд╣реИ рдХреНрдпрд╛?)
    cached = check_cache(text, 0.9, 1.0)
    if cached: 
        print("тЪб рдЯрд░реНрдмреЛ рдХреИрд╢ рд╕реЗ рд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛!")
        return cached

    # 2. рдЯреЗрдХреНрд╕реНрдЯ рдХреЛ рд╕реНрдорд╛рд░реНрдЯ рдФрд░ рд╕рд╛реЮ рдХрд░реЗрдВ (рд╣рдХрд▓рд╛рд╣рдЯ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП)
    clean_text = get_smart_text(text)
    
    # 3. рд╡реЙрдпрд╕ рдЬрдирд░реЗрд╢рди (рдЖрдкрдХреА рд▓реЙрдХ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рд╕рд╛рде)
    tts.tts_to_file(
        text=clean_text,
        speaker_wav="./speaker.wav", # рдпрд╣рд╛рдБ рдЕрдкрдиреА рдЖрд╡рд╛рдЬ рдХрд╛ рд╕реИрдВрдкрд▓ рджреЗрдВ
        language="hi",
        file_path=output_file,
        speed=1.0,
        repetition_penalty=20.0,
        temperature=0.7
    )
    
    # 4. рдпрд╛рджрджрд╛рд╢реНрдд рдореЗрдВ рд╕реЗрд╡ рдХрд░реЗрдВ
    save_to_memory(text)
    return output_file
